
# ELF 主加载

基础脚本分为


| 名称 | 含义 |
|--|--|
| .file | 程序所有文件的名称、类型和url路径对应表 |
| .data | 全局变量部分，可以通过修饰符来定义常量或变量 |
| .start | 程序开始位置，相当于脚本的main函数位置 |
| .table | 程序所有函数与文件对应关系，程序不会处理，仅作为标识（后续可能作为预加载指示） |
| .form | 界面文件，通过json文件来注册，程序不会处理，仅作为标识（后续可能作为预加载指示） |
| .code | 代码文件，通过moe文件来注册，程序不会处理，仅作为标识（后续可能作为预加载指示） |

注意，所有的资源路径必须在程序被初始化时被设置，不接受任何中途加载的资源路径，包括音频，图像

## file

基本格式：

```text
name type url

.file
main script TestMoe1/main.moe
```

即名称、类型、URL的合集

注意，这里URL应该是资源的相对路劲URL，而非绝对路劲。完整路径为基本网址+相对路径来组成完整的游戏资源访问路径。

文件类型有如下几大类：

1. 图片
2. 音频
3. 脚本（文本/代码）
4. 界面（文本/代码）
5. 二进制

值得注意的是，对于文本文件，脚本(script)和界面(ui)文件默认为代码文件，会自动读取和分析

## table

需要注意的是，table不会被初始加载，这只是ELF文件的一个属性，当读取到一个新的脚本文件时，程序会自动加载该文件的函数表到table段中。即这是一个自动化的处理过程，代码编写者不需要关心

另外，对于代码的函数而言，任何函数都可以在任何位置被调用，任意函数名称都应该只出现一次，如果同一个函数名称出现多次，那么会在table预处理时抛出异常

## data

基本格式：

```text
[const|static|var|ref] [int|string|float] name[size:...]

.data
const int A:10
const float Float:20
const string str
static int B,C,D
```

例如定义一个全局静态整形变量 A，全局常量字符串 S，全局浮点变量 F，格式如下：

```
static int A
const string S
var float F
```

同时，一行可以定义多个变量，每个变量之间使用逗号隔开，数组名称后面紧跟方括号，其中使用冒号分隔的数字表示变维度和大小（数组大小）

例如定义三个整型全局变量A，B，C：

```text
var int A[1], B[1], C[1]
```

同时，代码允许缺省数组长度定义，这样将会得到一个长度和维度均为1的数组（即单个变量）

为保证代码简单性，脚本只提供三种基本类型（与 C# 类型严格对应）：

| 类型 | 说明 |
|-|-|
| int | 32位带符号整数 |
| string | 字符串，不限制长度，UTF-8编码 |
| float | 32位浮点数 |

需要注意的是，这些基本类型都是定长数组，在定义时必须指定长度！

如果需要单个变量而不是数组，则定义长度为1即可，同时，对于任意数组，直接访问数组名将返回第一个第一个元素，也就是下标为0的元素

同时，对于其对应的数组，与类C语言数组定义方式相似

```text
var int A[10], B[20], C[100:200]
```

注意，基本类型数组不支持动态扩容，仅能在定义时初始化大小

## start

指向一个函数名称，程序会从这个函数开始运行

```text
.start
main
```

注意，任何函数都应该全局唯一（后续`可能`会加入名称空间，但请尽量避免函数名字重复）

## table

暂时无用

## form

暂时无用

## form

暂时无用
